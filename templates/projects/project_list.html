{% extends 'base.html' %}
{% load static i18n %}

{% block title %}{% trans "Projects" %} - KBTuneco{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="bg-gradient-to-r from-primary to-primary-dark text-white py-16 rounded-2xl mb-8">
    <div class="max-w-6xl mx-auto px-4">
        <div class="flex flex-col md:flex-row items-center md:justify-between">
            <div class="mb-4 md:mb-0">
                <h1 class="text-4xl md:text-5xl font-bold font-display mb-2">
                    <i class="bi bi-folder mr-2"></i>{% trans "Projects" %}
                </h1>
                <p class="text-xl opacity-90">{% trans "Discover and collaborate on exciting projects" %}</p>
            </div>
            <div class="bg-white/10 rounded-xl px-4 py-2">
                <span class="text-lg font-semibold">
                    <i class="bi bi-collection mr-2"></i>{{ projects|length }} {% trans "Projects" %}
                </span>
            </div>
        </div>
    </div>
</section>

<!-- Action Buttons -->
<div class="text-center mb-8">
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
        {% if user.is_authenticated %}
            {% if user.profile.user_type != 'student' and user.profile.user_type != 'researcher' %}
                <a href="{% url 'project_create' %}" class="bg-primary hover:bg-primary-dark px-6 py-3 rounded-xl font-medium text-white transition-all shadow-lg">
                    <i class="bi bi-plus-circle mr-2"></i>{% trans "Create Project" %}
                </a>
            {% endif %}
        {% else %}
            <a href="{% url 'register' %}" class="bg-primary hover:bg-primary-dark px-6 py-3 rounded-xl font-medium text-white transition-all shadow-lg">
                <i class="bi bi-person-plus mr-2"></i>{% trans "Join to Create Projects" %}
            </a>
        {% endif %}
        <a href="{% url 'suggestions' %}" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-xl font-medium text-white transition-all shadow-lg">
            <i class="bi bi-lightbulb mr-2"></i>{% trans "Suggestions" %}
        </a>
        <a href="{% url 'dashboard' %}" class="border-2 border-gray-500 text-gray-700 hover:bg-gray-500 hover:text-white px-6 py-3 rounded-xl font-medium transition-all">
            <i class="bi bi-speedometer2 mr-2"></i>{% trans "Dashboard" %}
        </a>
    </div>
</div>

<!-- Search Section -->
<section class="bg-white rounded-xl shadow-md p-8 mb-8">
    <form method="get">
        <div class="flex flex-col md:flex-row gap-4 items-end">
            <div class="flex-1">
                <label for="search" class="block font-semibold mb-2">
                    <i class="bi bi-search mr-2"></i>{% trans "Search Projects" %}
                </label>
                <input
                    type="text"
                    name="q"
                    id="search"
                    placeholder="{% trans 'Search by title, description, or keywords...' %}"
                    value="{{ request.GET.q }}"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all"
                >
            </div>
            <button type="submit" class="bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-xl font-medium transition-all">
                <i class="bi bi-search mr-2"></i>{% trans "Search" %}
            </button>
            {% if request.GET.q %}
                <a href="{% url 'project_list' %}" class="border border-gray-300 text-gray-700 hover:bg-gray-300 px-6 py-3 rounded-xl font-medium transition-all">
                    <i class="bi bi-x-circle mr-2"></i>{% trans "Clear" %}
                </a>
            {% endif %}
        </div>
    </form>
</section>

<!-- Projects List -->
<div class="space-y-6">
    {% if projects %}
        {% for project in projects %}
        <div class="bg-white rounded-xl shadow-sm hover:shadow-lg transition-shadow border-l-4 border-primary p-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <h3 class="text-2xl font-bold mb-3">
                        <a href="{% url 'project_detail' project.id %}" class="text-gray-800 hover:text-primary transition-colors">{{ project.title }}</a>
                    </h3>

                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-medium">
                            <i class="bi bi-tag mr-1"></i>{{ project.get_project_type_display }}
                        </span>
                        <span class="px-3 py-1 bg-secondary/10 text-secondary rounded-full text-sm font-medium">
                            <i class="bi bi-mortarboard mr-1"></i>{{ project.get_specialization_needed_display }}
                        </span>
                        <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">
                            <i class="bi bi-circle-fill mr-1"></i>{{ project.get_status_display }}
                        </span>
                        {% if project.duration %}
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
                            <i class="bi bi-clock mr-1"></i>{{ project.duration }}
                        </span>
                        {% endif %}
                    </div>

                    <p class="text-gray-600 mb-4 leading-relaxed">{{ project.description|truncatewords:30 }}</p>

                    {% if project.keywords.all %}
                    <div class="border-t border-gray-200 pt-4">
                        <p class="text-sm text-gray-500 mb-2">
                            <i class="bi bi-tags mr-1"></i>{% trans "Keywords:" %}
                        </p>
                        <div class="flex flex-wrap gap-2">
                            {% for keyword in project.keywords.all %}
                            <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">{{ keyword.label }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>

                <div class="bg-gray-50 rounded-lg p-6">
                    <div class="space-y-3">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="bi bi-calendar mr-3 mr-2"></i>
                            <span>{% trans "Created:" %} {{ project.created_at|date:"M d, Y" }}</span>
                        </div>

                        <div class="flex items-center text-sm text-gray-600">
                            <i class="bi bi-person mr-2"></i>
                            <span>{% trans "By:" %} {{ project.posted_by.user.username }}</span>
                        </div>

                        {% if project.budget %}
                        <div class="flex items-center text-sm">
                            <i class="bi bi-cash mr-2 text-yellow-600"></i>
                            <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium">{{ project.budget }} TND</span>
                        </div>
                        {% endif %}
                    </div>

                    <div class="mt-6 space-y-3">
                        <a href="{% url 'project_detail' project.id %}" class="block w-full border border-primary text-primary hover:bg-primary hover:text-white py-2 px-4 rounded-lg text-center font-medium transition-all">
                            <i class="bi bi-eye mr-2"></i>{% trans "View Details" %}
                        </a>
                        {% if user.is_authenticated %}
                            {% if user.profile.user_type == 'student' or user.profile.user_type == 'researcher' %}
                                {% if project.status == 'open' %}
                                    {% if project.user_has_applied %}
                                        <form method="post" action="{% url 'project_withdraw' project.id %}">
                                            {% csrf_token %}
                                            <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition-all">
                                                <i class="bi bi-x-circle mr-2"></i>{% trans "Withdraw" %}
                                            </button>
                                        </form>
                                    {% else %}
                                        <form method="post" action="{% url 'project_apply' project.id %}">
                                            {% csrf_token %}
                                            <button type="submit" class="block w-full bg-primary hover:bg-primary-dark text-white py-2 px-4 rounded-lg text-center font-medium transition-all">
                                                <i class="bi bi-person-plus mr-2"></i>{% trans "Apply" %}
                                            </button>
                                        </form>
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- Statistics Section -->
        <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl p-8 mt-12">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 text-center">
                <div>
                    <div class="text-3xl font-bold text-primary mb-1">{{ projects|length }}</div>
                    <div class="text-sm text-gray-600 uppercase tracking-wide font-semibold">{% trans "Total Projects" %}</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-green-600 mb-1">{{ projects|length }}</div>
                    <div class="text-sm text-gray-600 uppercase tracking-wide font-semibold">{% trans "Available" %}</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-blue-600 mb-1">Multiple</div>
                    <div class="text-sm text-gray-600 uppercase tracking-wide font-semibold">{% trans "Specializations" %}</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-yellow-600 mb-1">Active</div>
                    <div class="text-sm text-gray-600 uppercase tracking-wide font-semibold">{% trans "Community" %}</div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="text-center py-16 bg-white rounded-xl">
            <i class="bi bi-folder-x text-8xl text-gray-300 mb-6"></i>
            <h3 class="text-2xl font-bold text-gray-700 mb-4">{% trans "No Projects Found" %}</h3>
            {% if request.GET.q %}
                <p class="text-gray-600 mb-6">{% trans "No projects match your search criteria. Try different keywords or" %} <a href="{% url 'project_list' %}" class="text-primary hover:underline">{% trans "view all projects" %}</a>.</p>
            {% else %}
                <p class="text-gray-600 mb-6">{% trans "Be the first to create a project and start collaborating!" %}</p>
                <a href="{% url 'project_create' %}" class="bg-primary hover:bg-primary-dark px-6 py-3 rounded-xl font-medium text-white transition-all shadow-lg">
                    <i class="bi bi-plus-circle mr-2"></i>{% trans "Create First Project" %}
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Animate project cards on load
        const projectCards = document.querySelectorAll('.project-card');
        projectCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
        
        // Add search functionality
        const searchInput = document.getElementById('search');
        if (searchInput) {
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    this.closest('form').submit();
                }
            });
        }
        
        // Add hover effects to action buttons
        const actionBtns = document.querySelectorAll('.action-btn');
        actionBtns.forEach(btn => {
            btn.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
            });
            
            btn.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
        
        // Highlight search terms
        const searchTerm = '{{ request.GET.q }}';
        if (searchTerm) {
            const projectTitles = document.querySelectorAll('.project-title');
            projectTitles.forEach(title => {
                const text = title.textContent;
                const highlightedText = text.replace(
                    new RegExp(searchTerm, 'gi'), 
                    '<mark>$&</mark>'
                );
                title.innerHTML = highlightedText;
            });
        }
    });
</script>
{% endblock %}
